version: '{build}'

branches:
  only:
  - master

init:
- git config --global core.autocrlf false

before_build:
- appveyor-retry dotnet restore -v Minimal
- choco install opencover.portable
- choco install codecov

environment:
 matrix:
  - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017

build_script:
- dotnet build
- choco install "msbuild-sonarqube-runner" -y
- SonarScanner.MSBuild.exe begin /k:"Lauchi_Microwave" /d:sonar.organization="lauchi-github" /d:sonar.host.url="https://sonarcloud.io" /d:sonar.login="b8ffd4a0a866ccd049eb69e2c0f812bffb573409"
- MsBuild.exe /t:Rebuild
- SonarScanner.MSBuild.exe end /d:sonar.login="b8ffd4a0a866ccd049eb69e2c0f812bffb573409"

test_script:
- OpenCover.Console.exe -register:user -target:"C:/Program Files/dotnet/dotnet.exe" -targetargs:test -output:"coverage.xml" -oldstyle
- codecov -f "coverage.xml"

artifacts:
- path: coverage.xml
  name: MyCoverage