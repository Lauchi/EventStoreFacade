version: '0.7.3'

branches:
  only:
  - release

dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'
  informational_version: '{version}'

services:
  - mongodb

init:
  - git config --global core.autocrlf false

before_build:
  - appveyor-retry dotnet restore -v Minimal
  - choco install opencover.portable
  - choco install codecov

environment:
  matrix:
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017

build_script:
  - dotnet build

test_script:
  - dotnet test

artifacts:
  - path: '**\*.nupkg'

after_build:
  - ps: Get-ChildItem .**\*.nupkg | % { Push-AppveyorArtifact $_.FullName -FileName $_.Name }